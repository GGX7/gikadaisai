<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<title>模擬店・キッチンカー - 第48回 技科大祭</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="第48回技科大祭の模擬店・キッチンカーの一覧です。">
	<link rel="stylesheet" href="css/style.css">
	<link rel="icon" href="images/HP_icon.png">
</head>

<body>
<div id="container">

<header>
	<div id="logo">
		<a href="index.html">
			<div id="daigaku">豊橋技術科学大学</div>
			<div id="gikadaisai">第48回技科大祭</div>
		</a>
	</div>

	<div id="menubar">
		<nav id="menubar-pc">
			<ul>
				<li><a href="index.html">トップ</a></li>
				<li class="ddmenu_parent"><a href="#">企画</a>
					<ul>
						<li><a href="events.html">イベント</a></li>
						<li><a href="shops.html">模擬店・キッチンカー</a></li>
						<li><a href="timetable.html">タイムテーブル</a></li>
					</ul>
				</li>
				<li><a href="outline.html">協賛</a></li>
				<li><a href="access.html">アクセス</a></li>
				<li><a href="contact.html">お問い合わせ</a></li>
			</ul>
		</nav>
		<nav id="menubar-sp">
			<ul>
				<li><a href="index.html">トップ</a></li>
				<li><a href="events.html">イベント</a></li>
				<li><a href="shops.html">模擬店・キッチンカー</a></li>
				<li><a href="timetable.html">タイムテーブル</a></li>
				<li><a href="outline.html">協賛</a></li>
				<li><a href="access.html">アクセス</a></li>
				<li><a href="contact.html">お問い合わせ</a></li>
			</ul>
		</nav>
	</div>
</header>

<div id="contents">

<main>

<section>
	<h2><span>Shops</span><span class="hosoku">模擬店・キッチンカー</span></h2>

	<div class="view-options">
		<div class="filter-sort-controls">
			<div class="control-group">
				<label for="filter-type">絞り込み:</label>
				<select id="filter-type">
					<option value="all" selected>すべて</option>
					<option value="indoor">屋内企画</option>
					<option value="tent">屋外企画</option>
				</select>
			</div>
			<div class="control-group">
				<label for="sort-key">並び替え:</label>
				<select id="sort-key">
					<option value="default" selected>デフォルト</option>
					<option value="circle">団体名順</option>
					<option value="location">場所順</option>
				</select>
				<select id="sort-order">
					<option value="asc">昇順</option>
					<option value="desc">降順</option>
				</select>
			</div>
		</div>
	</div>

	<div id="shop-list" class="shop-list-container">
		</div>

</section>

</main>

</div>
<footer>
    <div class="footer-container">
        <div class="footer-col">
            <div class="logo-footer">
                <a href="index.html">
                    <span class="daigaku-footer">豊橋技術科学大学</span>
                    <span class="gikadaisai-footer">第48回技科大祭</span>
                </a>
            </div>
            <address class="footer-address">
                〒441-8580<br>
                愛知県豊橋市天伯町雲雀ヶ丘1-1
            </address>
        </div>
        <div class="footer-col">
            <h4>Menu</h4>
            <ul class="footer-nav">
                <li><a href="index.html">トップ</a></li>
                <li><a href="events.html">イベント</a></li>
                <li><a href="shops.html">模擬店・キッチンカー</a></li>
                <li><a href="timetable.html">タイムテーブル</a></li>
                <li><a href="outline.html">協賛</a></li>
                <li><a href="access.html">アクセス</a></li>
                <li><a href="contact.html">お問い合わせ</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Links</h4>
            <ul class="footer-nav">
                <li><a href="https://www.tut.ac.jp/">大学公式サイト</a></li>
                <li><a href="https://x.com/tut_festival">公式X(Twitter)</a></li>
                <li><a href="https://www.instagram.com/tut_festival/">公式Instagram</a></li>
            </ul>
        </div>
    </div>
    <div class="footer-bottom">
        <small>Copyright&copy; 第48回技科大祭実行委員会 All Rights Reserved.</small>
    </div>
</footer>

<div class="pagetop"><a href="#"><i class="fas fa-angle-double-up"></i></a></div>

</div>
<div id="menubar_hdr">
<span></span><span></span><span></span>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/protonet-jquery.inview/1.1.2/jquery.inview.min.js"></script>
<script src="js/main.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const shopListContainer = document.getElementById('shop-list');
    const filterSelect = document.getElementById('filter-type');
    const sortKeySelect = document.getElementById('sort-key');
    const sortOrderSelect = document.getElementById('sort-order');

    let allShops = [];

    const renderList = () => {
        if (!shopListContainer) return;

        const filterValue = filterSelect.value;
        let filteredShops;
        if (filterValue === 'indoor') {
            filteredShops = allShops.filter(shop => shop.place === '室内');
        } else if (filterValue === 'tent') {
            filteredShops = allShops.filter(shop => shop.place === '屋外');
        } else {
            filteredShops = [...allShops];
        }

        const sortKey = sortKeySelect.value;
        const sortOrder = sortOrderSelect.value;
        if (sortKey !== 'default') {
            filteredShops.sort((a, b) => sortCompare(a, b, sortKey, sortOrder));
        }

        shopListContainer.innerHTML = generateHtmlForShops(filteredShops) || '<p>該当する企画はありません。</p>';
    };

    const sortCompare = (a, b, key, order) => {
        let valA = a[key];
        let valB = b[key];
        let comparison = String(valA).localeCompare(String(valB), 'ja', { numeric: true, sensitivity: 'base' });
        return order === 'asc' ? comparison : -comparison;
    };

    const generateHtmlForShops = (shops) => {
        return shops.map(shop => {
            const safeTitle = shop.title.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            const safeCircle = shop.circle.replace(/"/g, "&quot;");
            const id = shop.id;
            return `
                <div class="shop-card">
                    <div class="shop-card-image">
                        <img src="data/shop/icon/${id}.png" alt="${safeCircle} アイコン" onerror="this.onerror=null; this.src='data/shop/icon/default.png';">
                    </div>
                    <div class="shop-card-content">
                        <p class="shop-card-title">${safeTitle}</p>
                        <div class="shop-card-footer">
                            <span class="shop-card-circle">${safeCircle}</span>
                            <span class="shop-card-location">${shop.location}</span>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    };

    if (filterSelect && sortKeySelect && sortOrderSelect) {
        filterSelect.addEventListener('change', renderList);
        sortKeySelect.addEventListener('change', renderList);
        sortOrderSelect.addEventListener('change', renderList);
    }
    
    (async () => {
        try {
            const response = await fetch('js/shop.json');
            if (!response.ok) throw new Error('shop.jsonの読み込みに失敗しました。');
            allShops = await response.json();
            renderList();
        } catch (error) {
            console.error(error);
            shopListContainer.innerHTML = '<p>企画情報の読み込み中にエラーが発生しました。</p>';
        }
    })();
});
</script>
</body>
</html>